# Geological connectivity and hydraulic condcutivity upscaling

This repository includes the data processing and the results of the research work called: "Geological facies connectivity and upscaling in reservoir simulation for optimization of production forecasts".

## Abstract

The simulation of fluid flow through porous media involves the development of mathematical and computational models based on geological data, geophysical surveys and petrophysical properties of the reservoir rock. These data allow the construction of a map or fine grid of high resolution in which the simulation processes have high computational requirements. This is why it is necessary to perform an upscaling procedure in order to transfer the properties from the geological fine grid to a coarse simulation grid of lower resolution. It is essential in this process to ensure the least possible loss of information, especially of the heterogeneity of the media, since properties such as hydraulic conductivity and the connectivity of different conductive components of the reservoir strongly determine the flow and transport in the earth's subsurface. In this study, multi-gaussian media generated by random space functions is used to represent the large spatial variability of the hydraulic conductivity (kr). This kind of media was found  to reproduce in good degree the distribution of conductivity hydraulics observed in field measurements, but the connectivity of the more conductive components or classes of kr that defines the flow and transport is not completely defined. For example, tortuous channels of high (kr) that give rise to fast fluid flow pathways, aren‚Äôt captured. In particular, for multi-gaussian media, the intermediate (kr) classes form a connected network, while the extreme (high and low) (kr) classes form isolated blobs. To take into account a wider range of connectivity scenarios, the multi-gaussian media is modified by applying a Normal Score Transform (NST) that performs a spatial swap of the intermediate (kr) classes with the high (or the low) ones. After the NST, the (kr) classes are spatially reorganized so that it is the high (kr) classes (or the low ones) that form a connected network (or isolated blobs). Connected networks high (low) (kr) classes mimic high (low) (kr) tortuous channels (barriers) observed in natural media.

## **1 - Introduction**

The characterization of the equivalent properties obtained in the upscaling processes of heterogeneous media has numerous applications in different areas of science and engineering. For several decades, the electrical conductivity and equivalent thermal conductivity of mixtures, as well as the elastic properties of composite materials, have been studied {Maxwell, 1873; Bruggeman, 1935; Landau & Lifshitz, 1960; Auriault, 1983; Willot & Jeulin, 2009; Zhou et al., 2016}. Specifically in environmental and energy applications, the determination of equivalent hydraulic conductivity is of great interest in various disciplines linked to flow and transport in porous media, such as the characterization of groundwater flow {Matheron, 1967; Dykaar & Kitanidis, 1992; Sanchez-Vila & Carrera, 1997}, subsurface transport of solutes and pollutants {Panagiotou, & Kiriakidis, 2022; Schiavo et al., 2023}, production of geothermal renewable energy {Weijermars & Khanal, 2019; Hadrien et al., 2023}, applications for the energy transition such as carbon dioxide capture, utilization and storage (CCUS) {Bigi et al., 2013} combined with unconventional enhanced gas recovery (EGR) {Zhao, 2021, Renard & Ababou, 2022}, underground hydrogen storage {Zivar et al., 2021} and oil and gas reservoir engineering {Renard & de Marisily, 1997; Weijermars & Khanal, 2019}.

A long-standing question is how to retain the salient features of the original description while reducing the spatial or temporal resolution, typically by applying some sort of ‚Äúlow-pass filter‚Äù  {Germano, 1992, Dykaar & Kitanidis, 1992 (a), Dykaar & Kitanidis, 1992 (b)} with a given cutoff scale. For example, large eddy simulations (LES) are a ‚Äúfiltered‚Äù representation that reduce the computational burden required to fully solve the Navier Stokes equations of fluid flow. LES simulations are aimed to preserve only the coarse-scale features of the flow velocity field, while averaging the small scale ones {Minotti, 2000; Johnson, 2022}. The unfiltered (and more cpu time consuming) alternative is to perform direct numerical simulations (DNS).

While these upscaling procedures reduce computing time, the implied information loss has drawbacks. For instance, in LES simulations of the flow of two immiscible phases, blurring of the interface is frequently observed {Lanbourasse et al., 2007}.  As sharpness is a very distinctive feature of these flows, any satisfactory upscaling procedure should be able to retain it {Tryggvason & Lu, 2020}.

In groundwater flow, at the  Darcy scale, the key features to be retained during the upscaling procedure are high hydraulic conductivity channels and low conductivity barriers, which mostly determine the structure of the fluid velocity field. In other words, it is the connectivity of the high or low conductivity components or classes (here we use the term ‚Äúcomponents‚Äù in general, and ‚Äúclasses‚Äù particularly for continuous media) that should be preserved during upscaling. This is why so much research effort aimed to define, characterize and quantify connectivity {Knudby & Carrera, 2005; Renard & Allard, 2013; Colecchio et al., 2021}. 

## **2 - Flow upscaling in multi-gaussian media**

From a numerical point of view, upscaling of groundwater flow at the Darcy scale implies coarse graining the hydraulic conductivity of heterogeneous media, from the local point values kr provided by a geological description and defined over the fine grid, onto the equivalent conductivity Keq values, defined over the coarse grid over which flow and transport simulations are performed.

At least four characteristic lengths are involved in the upscaling procedure: the linear size Œî of the fine grid cell, or support scale; a characteristic length scale of the heterogeneity or integral scale I (if definable); the coarsening scale Œª, defined by the linear size of the target coarse grid cell; and the overall linear size L of the domain under study (see Fig. 1a and 1b in [**'0_connect_map.ipynb'**](https://github.com/XxkmoxX/connectivity_paper/blob/main/0_connect_map.ipynb) Jupyter Notebook file). A transition is expected between Œª ~ Œî and Œª >> I; in the latter limit, homogenization is achieved, and Keq becomes an intrinsic property of the media, the effective hydraulic conductivity Keff, independently of Œª. Also, large fluctuations typically appear when Œª ~ I {Boschan & N≈ìtinger, 2012}. Because of this, the dimensionless form of the coarsening scale Œª/I is frequently used.

On the other hand, the large spatial variability of the hydraulic conductivity in the subsurface has very often been represented by using random space functions (RSF) {Dagan, 1989}. Multi-gaussian media, among other types of media generated by using RSF, were found to reproduce in good degree the distribution of kr observed in field measurements {Hoeksema & Kitanidis, 1985; Sudicky, 1986}, were thus thoroughly studied {Gelhar, 1986; Dreuzy, 2010}, and considered as a benchmark of heterogeneity. In these media, the point values of hydraulic conductivity kr are the result of a random process characterized by a unimodal Gaussian (or normal) probability density function ùëÉ(Y), where Y = log(kr) (i.e. kr is lognormally distributed), geometric mean Kg and log conductivity variance $\sigma$(Y). The first two parameters fully characterize ùëÉ(Y) at the fine scale {Jankovic et al., 2017}, while the latter controls the degree of heterogeneity, which typically ranges over several orders of magnitude. Moreover, the spatial correlation of kr is given by a isotropic covariance function $\delta$(Y) with a certain integral length scale ùêº. As $\delta$(Y) is a smooth function, multi-gaussian media are continuous media, as opposed to, for example, boolean {Harter, 2005}, or categorical {Fleckenstein & Fogg, 2008} media. 

On the other hand, the stochastic approach involved in the use of RSF implies that, at the coarse scale, Keq is not defined as a deterministic value, but over an ensemble of realizations, and then, in turn, also characterized by a probability density function P[log(Keq)] with arithmetic mean„ÄàKeq„Äâ, geometric mean „Äà„ÄàKeq„Äâ„Äâ, log variance $\sigma$[log(Keq)] and skewness $\gamma$[log(Keq)] (the skewness is the third gaussian moment of a distribution). Under ergodic conditions, P[log(Keq)] reflects both spatial and ensemble statistics.

## **3 - Connectivity and equivalent hydraulic conductivity Keq** 

The connectivity of the more conductive components or classes of kr strongly determines Keq, but it is poorly captured by the most frequently used geostatistical descriptors (i.e. variogram), which are based on two-point statistics. For example, tortuous channels of high kr, that give rise to fast fluid flow pathways, aren‚Äôt captured. This motivated numerous studies that explored metrics or indicators as the source of more realistic and accurate connectivity metrics. 

In particular, for multi-gaussian media, the intermediate kr classes form a connected network, while the extreme kr classes form disconnected blobs. To take into account a wider range of connectivity scenarios {Zinn and Harvey 2003; Jankovic et al., 2017; Zarlenga et al., 2018} modified multi-gaussian media by applying a Normal Score Transform (NST) that performs a spatial swap of the intermediate kr classes with the high (or the low) ones. After the NST, the kr classes are spatially reorganized so that it is the high kr classes (or the low ones) that form a connected network (or isolated blobs).

Some 3D studies on equivalent hydraulic conductivity are available, but most previous works addressed only 2D cases due to the computational burden involved in 3D approaches. Very few works addressed 2D and 3D media simultaneously {Oriani, F. & Renard, P. 2014; Boschan, A. & N≈ìtinger, B. 2012}. As connectivity is intrinsically related to dimensionality, and because assessing the possible extrapolation of previous 2D results to 3D realistic cases is important, and, finally, to enhance the scope of our study, we have chosen to perform it both in 2D and 3D with the following connectivity structure characteristics:
<ul>
<li> Intermediate connectivity structure (ICS), the intermediate kr values form a connected network, while higher and lower kr values form isolated blobs. </li>
<li> High connectivity structure (HCS), the isolated zones with the low kr values are embedded in a matrix with the high kr values connected.</li>
<li> Low connectivity structure (LCS), the low kr values form the connected network and the highest form isolated blobs.</li>
<li> No structure (NS), spatially uncorrelated case used as a reference where there are not relation among kr classes.</li>
</ul>
In particular, a multi-gaussian media modified such as HCS mimics tortuous channels of high flow velocity, while a LCS type simulates flow barriers that could be observed in natural media.

In [**Fig. 2a, 2b, 3a & 3b**](https://github.com/XxkmoxX/connectivity_paper/blob/main/0_connect_map.ipynb) you can see examples of one realization of the Y-maps for the different connectivity structures: NS, ICS, HCS and LCS for (2a, 2d) 2D and (3a, 3b) 3D. In 2D case a zoom is also shown to give a visual idea of the type and texture of media structure.

## __4 - Results__

For each dimensionality, we examine first the dependence of pdf P[log(Keq)] with the coarsening scale $\lambda$. Then, we analyze the ensemble arithmetic mean „ÄàKeq„Äâ, the most frequently metric used in the literature to quantify Keq, or eventually its geometric mean„Äà„ÄàKeq„Äâ„Äâ, and finally its variance  $\sigma$[log(Keq), these are 1st and 2nd gaussian moments of P[log(Keq)] respectively. Deviations of P[log(Keq)] from a normal distribution are addressed in the discussion by analyzing the skewness $\gamma$[log(Keq)] the 3rd gaussian moment of P[log(Keq)].

### __a - 2D Geometric mean ‚ü®‚ü®Keq‚ü©‚ü©__

[__Fig. 4__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) in [**"1_2Dconnect_128_VF.ipynb"**](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows normalized geometric mean ‚ü®‚ü®Keq‚ü©‚ü©/Kg as a function of $\lambda$/l for HCS, ICS and LCS. It is observed that ‚ü®‚ü®Keq‚ü©‚ü© $\approx$ 1 in ICS for all $\sigma$(Y) values and for all $\lambda$ in agreement with Matheron, 1967. In HCS (LCS), ‚ü®‚ü®Keq‚ü©‚ü© increases (decrease) progressively from 1 for low $\lambda$ to reach an asymptotic value for $\lambda$ $\rightarrow$ $\infty$. The asymptotic values becomes larger (smaller) as $\sigma$(Y) increases (decreases).

### __b - 2D Arithmetic mean ‚ü®Keq‚ü©__

[__Fig. 5__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) in [**"1_2Dconnect_128_VF.ipynb"**](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows ‚ü®Keq‚ü©/Kg as a function of the dimensionless coarsening scale $\lambda$/l. It is observed in (b) (ICS) that ‚ü®Keq‚ü© $\rightarrow$ $Kg^{(\sigma(Y)/2)}$ as $\lambda$ $\rightarrow$ 0, ‚ü®Keq‚ü© $\rightarrow$ 
 Kg and ‚ü®Keq‚ü©/Kg converges to 1 (dotted black line) for all $\sigma$(Y). In (a) (HCS) the ‚ü®Keq‚ü©/Kg values lie above 1 and in (c) (LCS) ‚ü®Keq‚ü©/Kg values lie below 1 with an inversion for the different $\sigma$(Y) values.

### __c - 2D Probability density functions (PDF)__

[__Fig. 6__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) in [**"1_2Dconnect_128_VF.ipynb"**](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows 2D P[log(Keq)] for the high (HCS), intermediate (ICS) and low (LCS) connective structures for   $\sigma$(Y)=0.5, 1 and 2. For ICS, in agreement with {Boschan & N≈ìtinger, 2012; Colecchio et al., 2020}, P[log(Keq)] remains a normal distribution for all Œª, with $\sigma$[log(Keq)] decreasing as Œª increases. But, notably, for HCS and LCS , P[log(Keq)]  departs from normal, showing lack of symmetry or bias as Œª exceeds Œî, and becoming symmetric as Œª increases. The most evident feature of the asymmetry is a small bump that moves centerward, from high (HCS) or low (LCS) values of log Keq, as Œª increases. The asymmetry increases as $\sigma$(Y) increases. Also it is observed that P[log(Keq)] becomes more homogeneous as Œª becomes larger and more compact and wider as $\sigma$(Y) increases. 

### __d - 2D Skewness__

[__Fig. 7__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) in [**"1_2Dconnect_128_VF.ipynb"**](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows the skewness of P[log(Keq)] as a function of $\lambda$ / l for (a) ICS, (b) HCS and (c) LCS. Input variance: (‚ñ≥, bottom fill)  $\sigma$(Y)=0.5, (‚≠ò, left fill)  $\sigma$(Y)=1 and (‚óª, right fill)  $\sigma$(Y)=2. It shows a clear collapse for all $\sigma$(Y) for each connectivity structure. The $\gamma$[log(Keq)] values for ECI are close to zero, while for HCS are negatives with a minimum on $\lambda$ / l=1 and for LCS are positives with a maximum on $\lambda$ / l=1.

### __e - 2D Normalized variance__

[__Fig. 8a__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) in [**"1_2Dconnect_128_VF.ipynb"**](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows the normalized variance $(\lambda /l)^{2}\sigma[log(Keq)]/\sigma (Y)$ as a function of $\lambda$/l. The Normalized variance is obtained by multiplying $\sigma[log(Keq)]/\sigma (Y)$ by a normalizing factor $(\lambda /l)^{2}$ which estimates the number of  independent heterogeneity units (IHU) of size $l^{2}$ within a coarse cell of size $\lambda^{2}$. The fact that the $(\lambda /l)^{2}\sigma[log(Keq)]/\sigma (Y)$ tends to an asymptotic value as $\lambda$ $\rightarrow$ $\infty$ involve that it is only a function of the IHU. [__Fig. 8b__](https://gitlab.com/XxkmoxX/connectivity/-/blob/main/1_2Dconnect_128_VF.ipynb?ref_type=heads) shows the collapse of $(\lambda /l)^{2}\sigma[log(Keq)]/\sigma (Y)$ for all connectivity structures and input variances over the full $\lambda$ range.








